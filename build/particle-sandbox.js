!function e(t,a,n){function i(s,o){if(!a[s]){if(!t[s]){var c="function"==typeof require&&require;if(!o&&c)return c(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=a[s]={exports:{}};t[s][0].call(u.exports,function(e){var a=t[s][1][e];return i(a?a:e)},u,u.exports,e,t,a,n)}return a[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,a){function n(){this.ATAN2_BITS=6,this.ATAN2_BITS2=Math.floor(this.ATAN2_BITS<<1),this.ATAN2_MASK=Math.floor(~(-1<<this.ATAN2_BITS2)),this.ATAN2_COUNT=Math.floor(this.ATAN2_MASK+1),this.ATAN2_DIM=Math.floor(Math.sqrt(this.ATAN2_COUNT)),this.INV_ATAN2_DIM_MINUS_1=1/(this.ATAN2_DIM-1),this.DEG=180/Math.PI,this.atan2Array=new Array(this.ATAN2_COUNT);for(var e=0;e<this.ATAN2_DIM;e++)for(var t=0;t<this.ATAN2_DIM;t++){var a=e/this.ATAN2_DIM,n=t/this.ATAN2_DIM;this.atan2Array[t*this.ATAN2_DIM+e]=Math.atan2(n,a)}}t.exports=new n,n.prototype.atan2Deg=function(e,t){return this.atan2(e,t)*this.DEG},n.prototype.atan2=function(e,t){var a,n;0>t?(0>e?(t=-t,e=-e,n=1):(t=-t,n=-1),a=-3.141592653):(0>e?(e=-e,n=-1):n=1,a=0);var i=1/((e>t?e:t)*this.INV_ATAN2_DIM_MINUS_1),r=Math.floor(t*i),s=Math.floor(e*i);return(this.atan2Array[s*this.ATAN2_DIM+r]+a)*n}},{}],2:[function(e,t,a){var n=e("./Atan2"),i={};t.exports=i,i.arcCircle=2*Math.PI,i.isChrome=navigator.userAgent.indexOf("Chrome")>-1,i.isExplorer=navigator.userAgent.indexOf("MSIE")>-1,i.isFirefox=navigator.userAgent.indexOf("Firefox")>-1,i.isSafari=navigator.userAgent.indexOf("Safari")>-1,i.isOpera=navigator.userAgent.indexOf("Presto")>-1,i.isChrome&&i.isSafari&&(i.isSafari=!1),i.drawPolygon=function(e,t,a){if(t&&0!==t.length){var n=0;for(e.beginPath(),e.moveTo(t[n],a[n]),n=1;n<t.length;n++)e.lineTo(t[n],a[n]);e.lineTo(t[0],a[0]),e.closePath(),e.fill()}},i.drawCircle=function(e,t,a,n){e.beginPath(),e.arc(t,a,n,0,this.arcCircle,!1),e.closePath(),e.fill()},i.angleRad=function(e,t,a,i){return n.atan2(i-t,a-e)},i.angle=function(e,t,a,i){return 180*n.atan2(i-t,a-e)/Math.PI},i.distance=function(e,t){return Math.sqrt(e*e+t*t)},i.distanceSq=function(e,t){return e*e+t*t},i.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},i.mobileCheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}},{"./Atan2":1}],3:[function(e,t,a){function n(){this.centerX=400,this.centerY=300,this.drawOffsetX=0,this.drawOffsetY=0,this.drawScale=.5,this.drawOffsetXT=0,this.drawOffsetYT=0,this.drawScaleT=.5,this.totalMass=0,this.particles=[],this.panning=!1,this.drawTrailCount=0,this.frameCount=0,this.frameRate=0,this.frameLag=0,this.lastFrame=Date.now(),this.lastFrameReset=Date.now(),this.processingCount=0,this.processingTime=0,this.processingStart=Date.now(),this.generateParticleRateCount=0,this.Settings=o,this.largestParticleIndex=0}var i=e("./Quadtree"),r=e("./Particle"),s=e("./Keyboard"),o=e("./Settings");t.exports=n,n.instance={},n.setInstance=function(e){n.instance=e,$(document).trigger("Gravity.create")},n.initialize=function(e){n.canvasdisplay=e,n.contextdisplay=n.canvasdisplay.getContext("2d"),n.canvas=document.createElement("canvas"),n.canvasui=document.createElement("canvas"),n.context=n.canvas.getContext("2d"),n.contextui=n.canvasui.getContext("2d"),n.setInstance(new n),i.initializeQuadtree(n.instance),window.onresize=function(){n.setCanvasSize()},n.setCanvasSize(),n.beginUpdateTimer(),n.beginDrawTimer();for(var t=0;t<500*(1+10*Math.random());t++)n.addParticle((Math.random()*n.canvas.width-n.instance.centerX)/n.instance.drawScale-n.instance.drawOffsetX,(Math.random()*n.canvas.height-n.instance.centerY)/n.instance.drawScale-n.instance.drawOffsetY,0,0,10);$(document).trigger("Gravity.initialize")},$(n).on("AddParticle",function(e,t){if(null!=n.UI.unitPlacementStartX){var a=0,i=0;o.momentumAdd&&(a=(n.UI.unitPlacementStartX-t.x)/60/n.instance.drawScale,i=(n.UI.unitPlacementStartY-t.y)/60/n.instance.drawScale),n.addParticle((n.UI.unitPlacementStartX-n.instance.centerX)/n.instance.drawScale-n.instance.drawOffsetX,(n.UI.unitPlacementStartY-n.instance.centerY)/n.instance.drawScale-n.instance.drawOffsetY,a,i,10),n.UI.unitPlacementStartX=null,n.UI.unitPlacementStartY=null}}),n.UI=function(){this.unitPlacementStartX=null,this.unitPlacementStartY=null,this.mouseX=null,this.mouseY=null},n.newInstance=function(){delete n.instance,n.setInstance(new n),i.initializeQuadtree(n.instance)},n.loadInstance=function(e){if(e=n.validateName(e),0===e.length)return!1;var t=localStorage.getItem("gravityinstance"+e);if(null!=t){var a=JSON.parse(t);if(null!=a)return delete n.instance,n.setInstance(a),i.initializeQuadtree(n.instance),n.clear(),!0}return!1},n.deleteSave=function(e){return e=n.validateName(e),0===e.length?!1:(localStorage.removeItem("gravityinstance"+e),n.removeFromSaveList(e),!0)},n.validateName=function(e){if(null==e)return"";var t,a="",n=new RegExp("[a-zA-Z0-9]+");for(t=n.exec(e);null!=t;)a+=t,e=e.substring(t.index+t[0].length),t=n.exec(e);return a},n.save=function(e){if(e=n.validateName(e),0===e.length)return!1;i.clear(n.instance);var t=JSON.stringify(n.instance);if(null!=t){localStorage.setItem("gravityinstance"+e,t),n.addToSaveList(e);var a=localStorage.getItem("gravityinstance"+e);if(a===t)return i.initializeQuadtree(n.instance),!0}return i.initializeQuadtree(n.instance),!1},n.getSaveList=function(){var e=localStorage.getItem("saveList");return null==e?[]:JSON.parse(e)},n.addToSaveList=function(e){var t=n.getSaveList();-1===t.indexOf(e)&&t.push(e),localStorage.setItem("saveList",JSON.stringify(t))},n.removeFromSaveList=function(e){var t=n.getSaveList();-1!==t.indexOf(e)&&t.splice(t.indexOf(e),1),localStorage.setItem("saveList",JSON.stringify(t))},n.getImage=function(){return n.canvas.toDataURL("image/png").replace("image/png","image/octet-stream")},n.beginUpdateTimer=function(){setTimeout(function(){n.update()},1e3/n.instance.Settings.fpsTarget)},n.beginDrawTimer=function(){setTimeout(function(){n.draw()},33)},n.setCenterXY=function(){n.instance.centerX=n.canvas.width/2,n.instance.centerY=n.canvas.height/2},n.update=function(){if(n.beginUpdateTimer(),null!=n.instance&&!n.instance.Settings.paused){n.startUpdateStatistics();var e;for(e=0;e<n.instance.particles.length;e++)r.update(n.instance.particles[e]);for(i.updateRoot(r),e=n.instance.particles.length-1;e>=0;e--)r.updateInteract(n.instance.particles[e]);var t=n.largestParticle();n.instance.totalMass=0;var a;for(e=n.instance.particles.length-1;e>=0;e--)a=n.instance.particles[e],a.mass<=0&&0===a.trail.length?(n.instance.particles.splice(e,1),a.quadtree.remove(a)):n.instance.totalMass+=a.mass;var s=!1;for(e=n.instance.particles.length-1;e>=0;e--)a=n.instance.particles[e],(null==t||a.mass>t.mass)&&(t=a,s=!0);n.instance.largestParticleIndex=n.instance.particles.indexOf(t),n.instance.Settings.followLargest&&s&&n.clear(),n.instance.Settings.generateParticles&&n.instance.generateParticleRateCount--<=1&&n.instance.processingTime<500&&(n.instance.generateParticleRateCount=n.instance.Settings.generateParticleRate,n.generateParticles()),n.endUpdateStatistics()}},n.generateParticles=function(){for(var e=Math.random()*Math.PI*2,t=Math.random(),a=Math.abs(n.instance.Settings.generateParticleRandomizer);a--;)t*=Math.random();o.generateParticleRandomizer>0&&(t=1-t);var i=n.instance.Settings.generateParticleArea*t,r=Math.cos(e)*i,s=Math.sin(e)*i,c=Math.random()*n.instance.Settings.generateParticleSpeed*2-n.instance.Settings.generateParticleSpeed,l=Math.random()*n.instance.Settings.generateParticleSpeed*2-n.instance.Settings.generateParticleSpeed,u=n.instance.Settings.generateParticleSize/2+n.instance.Settings.generateParticleSize*Math.random();n.addParticle(r,s,c,l,u)},n.draw=function(){if(n.beginDrawTimer(),null!=n.instance&&!n.instance.Settings.paused){if(n.startDrawStatistics(),n.setCenterXY(),s.keys[187]||s.keys[107]||s.keys[61]?n.zoomIn(.2):(s.keys[189]||s.keys[109]||s.keys[173])&&n.zoomOut(.2),s.keys[37]&&(n.instance.drawOffsetXT+=10/n.instance.drawScale),s.keys[38]&&(n.instance.drawOffsetYT+=10/n.instance.drawScale),s.keys[39]&&(n.instance.drawOffsetXT-=10/n.instance.drawScale),s.keys[40]&&(n.instance.drawOffsetYT-=10/n.instance.drawScale),n.instance.drawScale!==n.instance.drawScaleT&&(n.instance.drawScale+=.2*(n.instance.drawScaleT-n.instance.drawScale),Math.abs(n.instance.drawScale-n.instance.drawScaleT)<.001&&(n.instance.drawScale=n.instance.drawScaleT),n.clear()),(n.instance.drawOffsetX!==n.instance.drawOffsetXT||n.instance.drawOffsetY!==n.instance.drawOffsetYT)&&(n.instance.drawOffsetX+=.15*(n.instance.drawOffsetXT-n.instance.drawOffsetX),n.instance.drawOffsetY+=.15*(n.instance.drawOffsetYT-n.instance.drawOffsetY),Math.abs(n.instance.drawOffsetX-n.instance.drawOffsetXT)<.1&&(n.instance.drawOffsetX=n.instance.drawOffsetXT),Math.abs(n.instance.drawOffsetY-n.instance.drawOffsetYT)<.1&&(n.instance.drawOffsetY=n.instance.drawOffsetYT),n.instance.Settings.followLargest||n.clear()),n.instance.Settings.followLargest){var e=n.largestParticle();n.instance.drawOffsetX=-e.x,n.instance.drawOffsetY=-e.y,n.instance.drawOffsetXT=-e.x,n.instance.drawOffsetYT=-e.y}1===n.instance.Settings.trailType?n.clear():2===n.instance.Settings.trailType&&30!==n.instance.Settings.trailLifetime&&n.instance.drawTrailCount++>=n.instance.Settings.trailLifetime&&(n.instance.drawTrailCount=0,n.context.fillStyle="rgba(0,0,0,"+1/(2*n.instance.Settings.trailLifetime)+")",n.context.fillRect(0,0,n.canvas.width,n.canvas.height));for(var t=0;t<n.instance.particles.length;t++){var a=n.instance.particles[t];null!=a&&r.draw(a,n)}n.instance.Settings.showQuadtree&&i.instance.draw(n),n.drawui(),n.contextdisplay.fillStyle="rgba(0,0,0,1)",n.contextdisplay.fillRect(0,0,n.canvasdisplay.width,n.canvasdisplay.height),n.contextdisplay.drawImage(n.canvas,0,0,n.canvas.width,n.canvas.height),n.contextdisplay.drawImage(n.canvasui,0,0,n.canvasui.width,n.canvasui.height),n.endDrawStatistics()}},n.drawui=function(){n.clearui(),null!=n.UI.unitPlacementStartX&&o.momentumAdd&&(n.contextui.strokeStyle="rgba(255,255,255,.2)",n.contextui.lineCap="round",n.contextui.lineWidth=2,n.contextui.beginPath(),n.contextui.moveTo(n.UI.mouseX,n.UI.mouseY),n.contextui.lineTo(n.UI.unitPlacementStartX,n.UI.unitPlacementStartY),n.contextui.stroke(),n.contextui.closePath())},n.clear=function(){n.context.fillStyle="rgba(0,0,0,1)",n.context.fillRect(0,0,n.canvas.width,n.canvas.height)},n.clearui=function(){n.contextui.clearRect(0,0,n.canvasui.width,n.canvasui.height)},n.zoom=function(e){e>0?n.zoomIn(e):n.zoomOut(-e)},n.zoomOut=function(e){n.instance.drawScaleT*=1-.1*(null!=e?e:1)},n.zoomIn=function(e){n.instance.drawScaleT/=1-.1*(null!=e?e:1)},n.pan=function(e,t){n.instance.drawOffsetXT+=e/n.instance.drawScale*2,n.instance.drawOffsetYT+=t/n.instance.drawScale*2},n.addParticle=function(e,t,a,i,s){var o=new r(e,t);return o.xm=a,o.ym=i,o.mass=s,r.initialize(o),n.instance.particles.push(o),o},n.setCanvasSize=function(){n.canvasdisplay.width=n.canvasui.width=n.canvas.width=$(window).width(),n.canvasdisplay.height=n.canvasui.height=n.canvas.height=$(window).height(),n.setCenterXY()},n.largestParticle=function(){return n.instance.particles[n.instance.largestParticleIndex]},n.particleCount=function(){return n.instance.particles?n.instance.particles.length:0},n.startDrawStatistics=function(){n.instance.processingStart=Date.now()},n.startUpdateStatistics=function(){n.instance.processingStart=Date.now(),n.instance.frameLag=Date.now()-n.instance.lastFrame-1e3/n.instance.Settings.fpsTarget,n.instance.lastFrame=Date.now()},n.endDrawStatistics=function(){n.instance.processingCount+=Date.now()-n.instance.processingStart},n.endUpdateStatistics=function(){n.instance.frameCount++,n.instance.processingCount+=Date.now()-n.instance.processingStart+n.instance.frameLag,Date.now()-1e3>n.instance.lastFrameReset&&(n.instance.lastFrameReset=Date.now(),n.instance.frameRate=n.instance.frameCount,n.instance.frameCount=0,n.instance.processingTime=n.instance.processingCount,n.instance.processingCount=0)},n.translateCoordinate=function(e,t){return{x:e*n.instance.drawScale,y:t*n.instance.drawScale}},n.setShowTrail=function(e){n.instance.Settings.showTrail=e,r.draw=e?r.drawWithTrail:r.drawWithoutTrail}},{"./Keyboard":4,"./Particle":5,"./Quadtree":6,"./Settings":7}],4:[function(e,t,a){function n(){this.keys=[],document.onkeydown=this.keyDown,document.onkeyup=this.keyUp}t.exports=new n,n.prototype.keyDown=function(e){n.keys[e.keyCode]=!0},n.prototype.keyUp=function(e){n.keys[e.keyCode]=!1}},{}],5:[function(e,t,a){function n(e,t){this.mass=0,this.x=e,this.y=t,this.px=e,this.py=t,this.trail=[],this.compaction=0,this.diameter=0,this.radius=0,this.radiusSq=0,this.selfGravity=0,this.xm=0,this.ym=0,this.pxm=0,this.pym=0,this.ignoreGravity=0,this.ignoreCollisions=0,this.interactQuad=0,this.colorR=(75+180*Math.random()).toFixed(0),this.colorB=(75+180*Math.random()).toFixed(0),this.colorG=(75+180*Math.random()).toFixed(0),i.instance.add(this)}var i=e("./Quadtree"),r=e("./General"),s=e("./Settings");t.exports=n,n.quadtreeInteractDelay=0,n.initialize=function(e){n.updateVariables(e)},n.updateMisc=function(e){e.mass>=50001&&(e.compaction=(e.mass-5e4)/2e5,n.updateVariables(e))},n.updateMovement=function(e){var t=Math.floor(e.x/e.quadtree.d),a=Math.floor(e.y/e.quadtree.d);e.x+=e.xm,e.y+=e.ym,(t!==Math.floor(e.x/e.quadtree.d)||a!==Math.floor(e.y/e.quadtree.d))&&(e.quadtree.remove(e),i.instance.add(e))},n.update=function(e){s.showTrail&&1===s.trailType?n.updateTrail(e):e.trail.length>0&&(e.trail=[]),e.mass<=0||(n.updatePrevious(e),n.updateMisc(e),n.updateMovement(e))},n.updateInteractQuadtree=function(e){if(e.interactQuad++,!(e.interactQuad>=n.quadtreeInteractDelay)){for(var t,a,i=e.quadtree.far,s=i.length;s--;)t=i[s],t.mass>0&&(a=r.distance(e.x-t.x,e.y-t.y),n.applyGravity(e,t,a,e.interactQuad));e.interactQuad=0}},n.updateInteractNearby=function(e){for(var t,a,i=e.quadtree.nearbyObjects,o=i.indexOf(e);o--&&o>=0;)if(t=e.quadtree.nearbyObjects[o],t!==e&&t.mass>0&&(a=r.distance(e.x-t.x,e.y-t.y),a<=e.radius+t.radius?s.enableCollision===!0&&e.ignoreCollisions<=0&&t.ignoreCollisions<=0&&n.handleCollision(e,t):n.applyGravityMutually(e,t,a),e.mass<=0))return},n.updateInteract=function(e){e.mass<=0||(n.updateInteractQuadtree(e),n.updateInteractNearby(e),e.ignoreCollisions>0&&e.ignoreCollisions--,e.ignoreGravity>0&&e.ignoreGravity--)},n.updatePrevious=function(e){e.px=e.x,e.py=e.y,e.pxm=e.xm,e.pym=e.ym},n.updateTrail=function(e){e.mass>0&&e.trail.push({x:e.px,y:e.py,a:1,diameter:e.diameter});for(var t=e.trail.length;t--;){var a=e.trail[t];a.a-=1/s.trailLifetime,a.a<0&&e.trail.splice(t,1)}},n.drawWithoutTrail=function(e,t){var a=n.getDrawVector(e.x,e.y,t);t.context.fillStyle="rgb("+e.colorR+","+e.colorG+","+e.colorB+")",r.drawCircle(t.context,a.x,a.y,Math.max(.5,e.radius*t.instance.drawScale))},n.drawWithTrail=function(e,t){t.canvas.lineCap="round";var a;if(1===s.trailType)for(var i=0;i<e.trail.length-2;i+=2){var r=e.trail[i],o=e.trail[i+1],c=e.trail[i+2],l=n.getDrawVector(r.x,r.y,t),u=n.getDrawVector(o.x,o.y,t);a=n.getDrawVector(c.x,c.y,t),t.context.beginPath(),t.context.lineWidth=Math.max(.5,r.diameter*t.instance.drawScale),t.context.moveTo(l.x,l.y),t.context.quadraticCurveTo(u.x,u.y,a.x,a.y),t.context.strokeStyle="rgba("+e.colorR+","+e.colorG+","+e.colorB+","+c.a+")",t.context.stroke(),t.context.closePath()}var d=n.getDrawVector(e.x,e.y,t),h=a||n.getDrawVector(e.px,e.py,t);t.context.beginPath(),t.context.moveTo(h.x,h.y),t.context.lineTo(d.x,d.y),t.context.lineWidth=Math.max(.5,e.diameter*t.instance.drawScale),t.context.lineCap="round",t.context.strokeStyle="rgb("+e.colorR+","+e.colorG+","+e.colorB+")",t.context.stroke(),t.context.closePath()},n.draw=n.drawWithoutTrail,n.getDrawVector=function(e,t,a){return{x:(e+a.instance.drawOffsetX)*a.instance.drawScale+a.instance.centerX,y:(t+a.instance.drawOffsetY)*a.instance.drawScale+a.instance.centerY}},n.applyGravityMutually=function(e,t,a){if(0!==a&&!(e.ignoreGravity>0||t.ignoreGravity>0)){var n=a*(1+a*s.gravityExponential),i=e.x-t.x,r=e.y-t.y,o=Math.sqrt(i*i+r*r);i/=o,r/=o;var c=t.mass/n*s.gravityProportion,l=e.mass/n*s.gravityProportion;e.xm-=i*c,e.ym-=r*c,t.xm+=i*l,t.ym+=r*l}},n.applyGravity=function(e,t,a,n){if(0!==a){var i=a*(1+a*s.gravityExponential),r=e.x-t.x,o=e.y-t.y,c=Math.sqrt(r*r+o*o);r/=c,o/=c;var l=t.mass/i*s.gravityProportion*n;e.xm-=r*l,e.ym-=o*l}},n.handleCollision=function(e,t){n.spreadVelocity(e,t,Math.min(e.mass,t.mass)/2),n.MassExchange(e,t)},n.MassExchange=function(e,t){var a;e.mass>t.mass?(a=Math.min(t.mass,Math.max(t.mass*(e.mass/t.mass)/100,.1)),e.mass+=a,t.mass-=a):(a=Math.min(e.mass,Math.max(e.mass*(t.mass/e.mass)/100,.1)),e.mass-=a,t.mass+=a),n.updateVariables(e),n.updateVariables(t)},n.spreadVelocity=function(e,t,a){var n=e.xm,i=e.ym,r=a/(e.mass+a),s=a/(t.mass+a);e.xm=e.xm*(1-r)+t.xm*r,e.ym=e.ym*(1-r)+t.ym*r,t.xm=t.xm*(1-s)+n*s,t.ym=t.ym*(1-s)+i*s},n.updateVariables=function(e){e.diameter=Math.sqrt((1+e.mass)/(1+e.compaction)),e.radius=.5*e.diameter,e.radiusSq=e.radius*e.radius;var t=e.diameter*(1+e.diameter*s.gravityExponential);e.selfGravity=e.mass/t*s.gravityProportion/4},n.pullCenter=function(e){var t=1+r.distance(e.x,e.y),a=r.angleRad(e.x,e.y,0,0);e.xm+=1e-8*Math.cos(a)*t,e.ym+=1e-8*Math.sin(a)*t},n.explode=function(e,t){for(var a=2+Math.log(e.selfGravity),n=10;n--&&e.mass>0;){var i=1-Math.random()*Math.random()*Math.random(),r=Math.random()*Math.PI*2,s=10+100*Math.random();e.mass-=s;var o=t.addParticle(e.x,e.y,Math.cos(r)*i*a+e.xm,Math.sin(r)*i*a+e.ym,s);o.ignoreCollisions=60,o.ignoreGravity=60}},n.breakParticle=function(e,t,a){if(!(a.instance.particles.length>200))for(var n=50+t.mass/e.mass;e.mass>n;)e.mass-=t.mass,a.addParticle(e.x,e.y,e.xm,e.ym,Math.min(e.mass,10+e.mass*Math.random()))},n.unCollide=function(e,t){var a=r.angleRad(e.x,e.y,t.x,t.y);e.x=t.x-Math.cos(a)*(e.radius+t.radius+2),e.y=t.y-Math.sin(a)*(e.radius+t.radius+2)},n.unCollideAll=function(e,t){for(var a,i,s=t.instance.particles.length-1;s>=0;s--)a=t.instance.particles[s],e!==a&&(i=r.distance(e.x-a.x,e.y-a.y),i<e.radius+a.radius&&(e.mass>a.mass?n.unCollide(a,e):n.unCollide(e,a)))}},{"./General":2,"./Quadtree":6,"./Settings":7}],6:[function(e,t,a){function n(e){t.exports.instance=o=new s(null,0,0);for(var a=e.particles,n=a.length;n--;)o.add(a[n])}function i(e){for(var a=e.particles,n=a.length;n--;)a[n].quadtree=null;t.exports.instance=o=new s(null,0,0)}function r(e){e.quadtreeInteractDelay=2*Math.sqrt(this.instance.all.length);for(var t=this.instance.all.length;t--;)this.instance.all[t].update();this.instance.requiresUpdate=!1}function s(e,t,a){isNaN(t)||isNaN(a)||(null==e?(this.all=[],this.tree=[],this.children=[],this.requiresUpdate=!1):(this.parent=e,this.configureAsChild()),this.d=null==e?1e5:e.cd,this.left=t,this.top=a,this.cd=this.d/2,this.mass=0,this.count=0)}var o,c=e("./General");t.exports={instance:null,initializeQuadtree:n,clear:i,updateRoot:r},s.prototype.update=function(){this.calculate(),o.requiresUpdate&&(this.updateNearby(),this.updateFar())},s.prototype.updateNearby=function(){this.nearby=[],this.nearbyObjects=[];for(var e=this.left,t=this.top,a=e-1;e+1>=a;a++)for(var n=t-1;t+1>=n;n++){var i=o.getSector(a*this.d,n*this.d,this.d,!1);if(null!=i&&-1===this.nearby.indexOf(i)){this.nearby.push(i);for(var r=i.getAllObjects(),s=r.length;s--;)this.nearbyObjects.push(r[s])}}},s.prototype.updateFar=function(){this.far=[];for(var e=o.all.length;e--;){var t=o.all[e];if(-1===this.nearby.indexOf(t)){for(var a=this.nearby.length,n=!0;a--;)this.nearby[a].getAllChildren().indexOf(t)>=0&&(n=!1);n&&this.far.push(t)}}},s.prototype.draw=function(e){for(var t=e.context,a=o.all.length;a--;){var n=this.all[a];if(null!=n.objects){var i=e.translateCoordinate(n.left*n.d+e.instance.drawOffsetX,n.top*n.d+e.instance.drawOffsetY),r=e.translateCoordinate(n.d,n.d);t.strokeStyle="rgba(50,50,50,1)",t.lineWidth="1px",t.strokeRect(i.x+e.instance.centerX,i.y+e.instance.centerY,r.x,r.y),i=e.translateCoordinate(n.x+e.instance.drawOffsetX,n.y+e.instance.drawOffsetY),t.fillStyle="rgba(255,0,0,1)",c.drawCircle(e.context,i.x+e.instance.centerX,i.y+e.instance.centerY,2)}}},s.prototype.calculate=function(){if(null==this.objects||0===this.objects.length)this.x=this.y=this.mass=0;else{var e=this.objects.length;for(this.x=this.y=this.mass=0;e--;){var t=this.objects[e];this.x+=t.x*t.mass,this.y+=t.y*t.mass,this.mass+=t.mass}this.x/=this.mass,this.y/=this.mass}},s.prototype.configureAsChild=function(){if(-1===this.parent.children.indexOf(this)){this.parent.children.push(this);for(var e=this.parent.children.length;e-->1;){var t=this.parent.children[e],a=this.parent.children[e-1];(t.left<a.left||t.left===a.left&&t.top<a.top)&&this.parent.children.push(this.parent.children.splice(e-1,1)[0])}}this.tree=null,this.children=null,this.objects=[],this.nearbyObjects=[],this.nearby=[],this.far=[],o.requiresUpdate=!0},s.prototype.configureAsParent=function(){this.tree=[],this.children=[];for(var e=this.objects.length;e--;){var t=this.objects.pop();t.quadtree=null,this.getSector(t.x,t.y,0,!0).add(t)}this.objects=null,this.nearbyObjects=null,this.nearby=null,this.far=null,o.requiresUpdate=!0},s.prototype.convertToParent=function(){this.configureAsParent(),o.all.splice(o.all.indexOf(this),1)},s.prototype.getSector=function(e,t,a,n){for(var i=this;null!=i.tree;){var r=Math.floor(e/i.cd),o=Math.floor(t/i.cd),c=i.tree[r];if(!n&&null==c)return null;if(null==c)c=i.tree[r]=[],i=c[o]=new s(i,r,o);else{var l=c[o];if(!n&&null==l)return null;i=c[o]=null!=l?l:new s(i,r,o)}if(i.d===a)break}return i},s.prototype.getAllChildren=function(){if(null==this.children)return[];for(var e=this.children.length,t=[];e--;){var a=this.children[e];t.push(a);for(var n=a.getAllChildren(),i=n.length;i--;)t.push(n[i])}return t},s.prototype.getAllObjects=function(){if(this.objects)return this.objects;for(var e=this.children.length,t=[];e--;)for(var a=this.children[e].getAllObjects(),n=a.length-1,i=-1;i++<n;)t.push(a[i]);return t},s.prototype.add=function(e){var t=this;for(t.count++;null!=t.tree;)t=t.getSector(e.x,e.y,t.cd,!0),t.count>=16&&null==t.tree&&t.convertToParent(),t.count++;if(t.objects.push(e),e.quadtree=t,t.nearby.length>0)for(var a=t.nearby.length;a--;){var n=t.nearby[a];null!=n.nearbyObjects&&n.nearbyObjects.push(e)}else o.requiresUpdate=!0;if(t.calculate(),1===t.count&&-1===o.all.indexOf(t)){o.all.push(t);for(var i=o.all.length;i-->1;){var r=o.all[i],s=o.all[i-1];(r.left<s.left||r.left===s.left&&r.top<s.top)&&o.all.push(o.all.splice(i-1,1)[0])}}},s.prototype.remove=function(e){var t=this.objects.indexOf(e);this.count--,this.objects.splice(t,1),e.quadtree=null;var a=this.nearbyObjects.indexOf(e);a>-1&&this.nearbyObjects.splice(a,1);for(var n=this.nearby.length;n--;){var i=this.nearby[n];null!=i.nearbyObjects&&(a=i.nearbyObjects.indexOf(e),a>-1&&i.nearbyObjects.splice(a,1))}0===this.count&&(a=o.all.indexOf(this),a>-1&&o.all.splice(a,1),o.requiresUpdate=!0);for(var r=this.parent;null!=r;)r.count--,0===r.count&&null!=r.parent&&r.configureAsChild(),r=r.parent}},{"./General":2}],7:[function(e,t,a){function n(){this.generateParticles=!1,this.generateParticleArea=5e4,this.generateParticleSpeed=0,this.generateParticleRandomizer=-2,this.generateParticleRate=6,this.generateParticleSize=10,this.gravityProportion=1,this.gravityExponential=1,this.enableCollision=!0,this.fpsTarget=30,this.followLargest=!1,this.trailLifetime=4,this.showTrail=!0,this.trailType=1,this.showQuadtree=!1,this.momentumAdd=!0,this.paused=!1}t.exports=new n},{}],8:[function(e,t,a){function n(){}var i=(e("./Gravity"),e("./Settings"));t.exports=n,n.initialize=function(){n.initializeFunctions()},n.initializeFunctions=function(){var e=$("#ps-toolbar");e.mouseleave(function(){$("#ps-toolbar").delay(500).animate({left:-110,borderRightColor:"#334"},200)}),e.mouseenter(function(){$("#ps-toolbar").clearQueue().animate({left:0,borderRightColor:"rgba(0, 0, 0, 0)"},200)}),e.find("div").click(function(){$(this).hasClass("active")?$(this).removeClass("active").siblings().addClass("active"):$(this).addClass("active").siblings().removeClass("active")}),$("#ps-toolbar-momentum").click(function(){i.momentumAdd=!i.momentumAdd})}},{"./Gravity":3,"./Settings":7}],9:[function(e,t,a){var n=e("./ui/Application");"ontouchstart"in document||(e("./ui/DesktopControllers"),e("./ui/DesktopEvents"),e("./ui/DesktopMenu")),"ontouchstart"in document&&(e("./ui/MobileControllers"),e("./ui/MobileEvents")),e("./ui/GenerateParticlesMenu"),e("./Atan2"),e("./General");var i=e("./Gravity");e("./Keyboard"),e("./Particle"),e("./Quadtree"),e("./Settings");var r=e("./Toolbox");n.run(function(){var e=document.getElementById("canvas");i.initialize(e),r.initialize(),i.setCanvasSize(),i.clear()})},{"./Atan2":1,"./General":2,"./Gravity":3,"./Keyboard":4,"./Particle":5,"./Quadtree":6,"./Settings":7,"./Toolbox":8,"./ui/Application":10,"./ui/DesktopControllers":11,"./ui/DesktopEvents":12,"./ui/DesktopMenu":13,"./ui/GenerateParticlesMenu":14,"./ui/MobileControllers":15,"./ui/MobileEvents":16}],10:[function(e,t,a){{var n=angular.module("particleSandbox",[]);e("./../Gravity"),e("./../Toolbox")}t.exports=n},{"./../Gravity":3,"./../Toolbox":8}],11:[function(e,t,a){var n=e("./../Gravity"),i=e("./Application");i.controller("gravity",["$scope","$http",function(e,t){e.paused=!1,e.showTrail=!0,e.trailType=2,e.trailLifetime=4,e.showTutorial=localStorage.getItem("showTutorial")||!0,e.tutorialIndex=0,t.get("json/tutorial.json").success(function(t){e.tutorialData=t}),e.tutorialNext=function(){e.tutorialIndex++>=e.tutorialData.length-1&&(e.showTutorial=!1)},e.tutorialDisable=function(){localStorage.setItem("showTutorial",!1),e.showTutorial=!1},e.$watch("paused",function(e,t){n.instance.Settings.paused=e}),e.$watch("showTrail",function(e,t){n.setShowTrail(e)}),e.$watch("trailType",function(e,t){n.instance.Settings.trailType=Number(e)}),e.$watch("trailLifetime",function(e,t){n.instance.Settings.trailLifetime=Number(e)}),e.togglePause=function(){e.paused=!e.paused},e.initialize=function(){e.paused=n.instance?n.instance.Settings.paused:!0},e.newInstance=function(){n.newInstance(),n.clear(),e.initialize()}}])},{"./../Gravity":3,"./Application":10}],12:[function(e,t,a){var n=e("./../Gravity");$(document).on("Gravity.initialize",function(){var e=$(".menu");n.canvasdisplay.onclick=function(t){return e.is(":visible")?(e.filter(":visible").slideToggle(150),!1):($(n).trigger("AddParticle",{x:t.clientX,y:t.clientY}),!1)},n.canvasdisplay.onmousedown=function(e){return $(".menu").is(":visible")?!1:(0!==e.button?(n.instance.panning=!0,n.instance.px=e.clientX,n.instance.py=e.clientY):(n.UI.unitPlacementStartX=e.clientX,n.UI.unitPlacementStartY=e.clientY),!1)};var t=function(e){e.wheelDelta>0||e.detail<0?(n.instance.drawOffsetXT+=.1*(n.instance.centerX-e.clientX)/n.instance.drawScale,n.instance.drawOffsetYT+=.1*(n.instance.centerY-e.clientY)/n.instance.drawScale,n.zoomIn()):(n.instance.drawOffsetXT+=.1*(n.instance.centerX-e.clientX)/n.instance.drawScale,n.instance.drawOffsetYT+=.1*(n.instance.centerY-e.clientY)/n.instance.drawScale,n.zoomOut())};window.chrome&&(document.onmousewheel=t),document.attachEvent?document.attachEvent("onmousewheel",t):window.addEventListener("DOMMouseScroll",t,!1),n.canvasdisplay.onmouseup=function(e){0!==e.button&&(n.instance.panning=!1)},n.canvasdisplay.onmousemove=function(e){n.instance.panning===!0&&(n.instance.drawOffsetXT-=(n.instance.px-e.clientX)/n.instance.drawScale,n.instance.drawOffsetYT-=(n.instance.py-e.clientY)/n.instance.drawScale,n.instance.px=e.clientX,n.instance.py=e.clientY),n.UI.mouseX=e.clientX,n.UI.mouseY=e.clientY},n.canvasdisplay.oncontextmenu=n.canvasdisplay.ondblclick=function(){return window.focus(),!1},document.onmousedown=function(){window.focus()}})},{"./../Gravity":3}],13:[function(e,t,a){var n=e("./../Settings"),i=e("./../General"),r=e("./../Gravity"),s=e("./GenerateParticlesMenu"),o={};t.exports=o,$(document).on("Gravity.initialize",function(){o.initialize(),$("#generate-particle-rate").slider().on("slide",function(){s.setGenerateParticleRate()}),$("#generate-particle-area").slider().on("slide",function(){s.setGenerateParticleArea()}),$("#generate-particle-speed").slider().on("slide",function(){s.setGenerateParticleSpeed()}),$("#generate-particle-randomizer").slider().on("slide",function(){s.setGenerateParticleRandomizer()}),$("#generate-particle-size").slider().on("slide",function(){s.setGenerateParticleSize()}),s.initializeView()}),$(document).on("Gravity.create",function(){o.initializeView(),s.initializeView()}),o.toggleCollision=function(){n.enableCollision=!n.enableCollision,o.updateCollision()},o.updateCollision=function(){n.enableCollision===!0?$("#toggle-collision").parent().addClass("ul-li-selected"):$("#toggle-collision").parent().removeClass("ul-li-selected")},o.toggleFollowLargest=function(){n.followLargest=!n.followLargest,o.updateFollowLargest()},o.updateFollowLargest=function(){n.followLargest===!0?$("#toggle-followLargest").parent().addClass("ul-li-selected"):$("#toggle-followLargest").parent().removeClass("ul-li-selected")},o.toggleShowQuadtree=function(){n.showQuadtree=!n.showQuadtree,o.updateShowQuadtree()},o.updateShowQuadtree=function(){var e=$("#toggle-quadtree");n.showQuadtree?(e.parent().addClass("ul-li-selected"),e.html("Hide Quadtree")):(e.parent().removeClass("ul-li-selected"),e.html("Show Quadtree"))},o.setGravityProportion=function(){var e=Math.floor(100*$("#gravity-proportion").slider().data("value"))/100;i.isNumber(e)&&(r.instance.gravityProportion=e/(21-20*r.instance.gravityExponential))},o.setGravityExponential=function(){var e=Math.floor($("#gravity-exponential").slider().data("value"))/100;i.isNumber(e)&&(r.instance.gravityExponential=e,o.setGravityProportion())},o.update=function(){$("#fps").html(r.instance.frameRate+" fps"),$("#cap").html((r.instance.processingTime/10).toFixed(1)+"%"),$("#particleCount").html(r.particleCount()),setTimeout(function(){o.update()},100)},o.initialize=function(){o.initializeFunctions(),o.initializeView();

},o.initializeView=function(){o.updateCollision(),o.updateFollowLargest(),o.updateShowQuadtree(),o.update()},o.initializeFunctions=function(){$("#toggle-collision").click(function(){o.toggleCollision()}),$("#toggle-followLargest").click(function(){o.toggleFollowLargest()}),$("#toggle-menu-generate-particles").click(function(){o.hideMenus(),$("#menu-generate-particles").slideToggle(150)}),$("#toggle-menu-gravity").click(function(){o.hideMenus(),$("#menu-gravity").slideToggle(150)}),$("#toggle-menu-trails").click(function(){o.hideMenus(),$("#menu-trails").slideToggle(150)}),$("#toggle-quadtree").click(function(){o.toggleShowQuadtree()}),$("#gravity-proportion").slider().on("slide",function(){o.setGravityProportion()}),$("#gravity-exponential").slider().on("slide",function(){o.setGravityExponential()}),$("#trail-lifetime").slider().on("slide",function(){var e=angular.element($("#trail-lifetime")).scope();e.$apply(function(){e.trailLifetime=$("#trail-lifetime").slider().data("value")})}),$("#load").click(function(){o.showPopLoad()}),$("#pop-load-button").click(function(){o.load()}),$("#pop-load-delete-button").click(function(){$("#pop-load-delete-confirm").show()}),$("#pop-load-delete-confirm-button").click(function(){o.deleteSave()}),$("#save").click(function(){$("#pop-save-image").attr("href",r.getImage()),$("#pop-save").show(),$("#pop-save input").focus().select()}),$("#pop-save-button").click(function(){o.save()}),$(".pop-close").click(function(e){$(e.target).parent().parent().hide()}),$(".pop-confirm-close").click(function(e){$(e.target).parent().hide()})},o.hideMenus=function(){$(".menu").hide()},o.load=function(){r.loadInstance($("#pop-load-name").val())?o.alertInfo("Load successful."):o.alertError("Load failed."),$("#pop-load").hide()},o.deleteSave=function(){r.deleteSave($("#pop-load-name").val())?o.alertInfo("Deletion successful."):o.alertError("Deletion failed."),$("#pop-load-delete-confirm").hide(),$("#pop-load").hide()},o.save=function(){r.save($("#pop-save-name").val())?o.alertInfo("Save successful."):o.alertError("Save failed."),$("#pop-save").hide()},o.showPopLoad=function(){var e="",t=r.getSaveList(),a=t.length;if(0===a)return void o.alertInfo("There are currently no saves.");for(;a--;)e+="<option>"+t[a]+"</option>";$("#pop-load-name").html(e),$("#pop-load").show()},o.exportFile=function(){var e=JSON.stringify(r.instance);if(null!=e){var t="data:application/octet-stream,"+encodeURIComponent(e);window.open(t,"particlesandbox.json")}},o.alertInfo=function(e){var t=document.createElement("div");$("#alerts").prepend($(t)),$(t).html(e),$(t).addClass("alert alert-info"),$(t).fadeTo(3e3,.5,function(){$(t).remove()})},o.alertError=function(e){var t=document.createElement("div");$("#alerts").prepend($(t)),$(t).html(e),$(t).addClass("alert alert-danger"),$(t).fadeTo(3e3,.5,function(){$(t).remove()})}},{"./../General":2,"./../Gravity":3,"./../Settings":7,"./GenerateParticlesMenu":14}],14:[function(e,t,a){var n=e("./../General"),i=e("./../Settings"),r={};t.exports=r,r.toggleGenerateParticles=function(){i.generateParticles=!i.generateParticles,r.updateGenerateParticles()},r.updateGenerateParticles=function(){i.generateParticles===!0?$("#generate-particle").val("Generating Particles").removeClass("btn-danger").addClass("btn-success"):$("#generate-particle").val("Generate Particles").removeClass("btn-success").addClass("btn-danger")},r.setGenerateParticleRate=function(){var e=$("#generate-particle-rate").slider().data("value");n.isNumber(e)&&(i.generateParticleRate=(30/e).toFixed(0),r.updateGenerateParticleRate())},r.updateGenerateParticleRate=function(){$("#generate-particle-rate-value").html((30/i.generateParticleRate).toFixed(0))},r.setGenerateParticleArea=function(){var e=$("#generate-particle-area").slider().data("value");n.isNumber(e)&&(e=100*e,i.generateParticleArea=e.toFixed(0),r.updateGenerateParticleArea())},r.updateGenerateParticleArea=function(){$("#generate-particle-area-value").html(i.generateParticleArea)},r.setGenerateParticleSpeed=function(){var e=$("#generate-particle-speed").slider().data("value");n.isNumber(e)&&(i.generateParticleSpeed=e.toFixed(1),r.updateGenerateParticleSpeed())},r.updateGenerateParticleSpeed=function(){$("#generate-particle-speed-value").html(i.generateParticleSpeed)},r.setGenerateParticleRandomizer=function(){var e=$("#generate-particle-randomizer").slider().data("value");n.isNumber(e)&&(i.generateParticleRandomizer=e.toFixed(0),r.updateGenerateParticleRandomizer())},r.updateGenerateParticleRandomizer=function(){$("#generate-particle-randomizer-value").html(i.generateParticleRandomizer<0?"Inner":i.generateParticleRandomizer>0?"Outer":"Neutral")},r.setGenerateParticleSize=function(){var e=$("#generate-particle-size").slider().data("value");n.isNumber(e)&&(i.generateParticleSize=e,r.updateGenerateParticleSize())},r.updateGenerateParticleSize=function(){$("#generate-particle-size-value").html(i.generateParticleSize)},r.toggleGenerateParticles=function(){i.generateParticles=!i.generateParticles,r.updateGenerateParticles()},r.updateGenerateParticles=function(){i.generateParticles===!0?$("#generate-particle").val("Generating Particles").removeClass("btn-danger").addClass("btn-success"):$("#generate-particle").val("Generate Particles").removeClass("btn-success").addClass("btn-danger")},r.initializeView=function(){r.updateGenerateParticleRate(),r.updateGenerateParticleSpeed(),r.updateGenerateParticleArea(),r.updateGenerateParticleRandomizer(),r.updateGenerateParticleSize()}},{"./../General":2,"./../Settings":7}],15:[function(e,t,a){var n=(e("./../Gravity"),e("./Application"));n.controller("gravity",["$scope",function i(e){e.paused=!1,e.view="play",e.$watch("paused",function(e,t){i.instance&&(i.instance.Settings.paused=e)}),e.$watch("view",function(t,a){e.paused="play"!==t}),e.initialize=function(){e.paused=i.instance.Settings.paused},e.newInstance=function(){i.newInstance(),i.clear(),e.initialize()},e.setView=function(t){e.view=t}}])},{"./../Gravity":3,"./Application":10}],16:[function(e,t,a){var n=e("./../Gravity"),i=e("./../General"),r={};r.Touch={lastTouches:[],touches:[],lastChangedTouches:[],changedTouches:[],lastSpacing:0,spacing:0,pageAverageX:0,pageAverageY:0,lastPageAverageX:0,lastPageAverageY:0,process:function(e){this.lastTouches=this.touches,this.lastChangedTouches=this.changedTouches,this.touches=e.touches,this.changedTouches=e.changedTouches,this.lastSpacing=this.spacing,this.lastPageAverageX=this.pageAverageX,this.lastPageAverageY=this.pageAverageY,this.calculate()},calculate:function(){if(this.spacing=0,this.pageAverageX=0,this.pageAverageY=0,2===this.touches.length){var e=this.touches[0],t=this.touches[1];this.spacing=Math.max(this.spacing,i.distance(e.pageX-t.pageX,e.pageY-t.pageY))}for(var a=0;a<this.touches.length;a++){var n=this.touches[a];this.pageAverageX+=n.pageX,this.pageAverageY+=n.pageY}this.pageAverageX/=this.touches.length,this.pageAverageY/=this.touches.length}},$(document).on("Gravity.initialize",function(){n.canvasdisplay.addEventListener("touchend",function(e){if(r.Touch.process(e),1===e.changedTouches.length&&0===e.touches.length){var t=e.changedTouches[0];$(n).trigger("AddParticle",{x:t.pageX,y:t.pageY})}return!1}),n.canvasdisplay.addEventListener("touchstart",function(e){if(r.Touch.process(e),1===e.touches.length){var t=e.touches[0];n.UI.unitPlacementStartX=t.pageX,n.UI.unitPlacementStartY=t.pageY}else e.touches.length>1&&(n.UI.unitPlacementStartX=null,n.UI.unitPlacementStartY=null);return!1}),n.canvasdisplay.addEventListener("touchmove",function(e){if(r.Touch.process(e),2===e.touches.length&&r.Touch.spacing!==r.Touch.lastSpacing){var t=(r.Touch.spacing-r.Touch.lastSpacing)/30;n.zoom(t);var a=r.Touch.pageAverageX-r.Touch.lastPageAverageX,i=r.Touch.pageAverageY-r.Touch.lastPageAverageY;n.pan(a,i)}return!1}),document.onmousedown=document.click=document.dblclick=function(){return!1}})},{"./../General":2,"./../Gravity":3}]},{},[9]);